

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Writing OONI tests &mdash; OONI: Open Observatory of Network Interference 2.0.1 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="OONI: Open Observatory of Network Interference 2.0.1 documentation" href="index.html"/>
        <link rel="next" title="Writing Test Helpers" href="writing_test_helpers.html"/>
        <link rel="prev" title="Tutorial" href="tutorial.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> OONI: Open Observatory of Network Interference
          

          
          </a>

          
            
            
              <div class="version">
                2.0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="tutorial.html">Tutorial</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Writing OONI tests</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#test-cases">Test Cases</a></li>
<li class="toctree-l2"><a class="reference internal" href="#inputs">Inputs</a></li>
<li class="toctree-l2"><a class="reference internal" href="#setup-and-command-line-passing">Setup and command line passing</a></li>
<li class="toctree-l2"><a class="reference internal" href="#test-methods">Test Methods</a></li>
<li class="toctree-l2"><a class="reference internal" href="#test-templates">Test Templates</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#scapy-based-tests">Scapy based tests</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#report-format">Report Format</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#tcp-based-tests">TCP based tests</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id1">Report format</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#http-based-tests">HTTP based tests</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id2">Report format</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#dns-based-tests">DNS based tests</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id3">Report format</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="writing_test_helpers.html">Writing Test Helpers</a></li>
<li class="toctree-l1"><a class="reference internal" href="reports.html">Reports</a></li>
<li class="toctree-l1"><a class="reference internal" href="reports.html#report-format-version-changelog">Report format version changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="nettests/modules.html">Implemented NetTests</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/ooni.html">Measurement Developer API</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/ooni.templates.html">Test Templates</a></li>
<li class="toctree-l1"><a class="reference internal" href="architecture.html">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">Glossary</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">OONI: Open Observatory of Network Interference</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>Writing OONI tests</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/writing_tests.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="writing-ooni-tests">
<h1>Writing OONI tests<a class="headerlink" href="#writing-ooni-tests" title="Permalink to this headline">¶</a></h1>
<p>The OONI testing API is heavily influenced and partially based on the python
<code class="xref py py-mod docutils literal"><span class="pre">unittest</span></code> module and <code class="xref py py-mod docutils literal"><span class="pre">twisted.trial</span></code>.</p>
<div class="section" id="test-cases">
<h2>Test Cases<a class="headerlink" href="#test-cases" title="Permalink to this headline">¶</a></h2>
<p>The atom of OONI Testing is called a Test Case. A test case class may contain
multiple Test Methods.</p>
<p>If the test you plan to write is not listed on the <a class="reference external" href="https://trac.torproject.org/projects/tor/wiki/doc/OONI/Tests">Tor OONI trac page</a>, you should
add it to the list and then add a description about it following the <a class="reference external" href="https://gitweb.torproject.org/ooni-probe.git/plain/docs/source/tests/template.rst">test
template</a>.</p>
<p>Tests are driven by inputs. For every input a new test instance is created,
internally the _setUp method is called that is defined inside of test
templates, then the setUp method that is overwritable by users.</p>
<p>Gotchas:
<strong>never</strong> call reactor.start of reactor.stop inside of your test method and all
will be good.</p>
</div>
<div class="section" id="inputs">
<h2>Inputs<a class="headerlink" href="#inputs" title="Permalink to this headline">¶</a></h2>
<p>Inputs are what is given as input to every iteration of the Test Case.
If you have 100 inputs, then every test case will be run 100 times.</p>
<p>To configure a static set of inputs you should define the
<code class="xref py py-class docutils literal"><span class="pre">ooni.nettest.NetTestCase</span></code> attribute <code class="docutils literal"><span class="pre">inputs</span></code>. The test will be
run <code class="docutils literal"><span class="pre">len(inputs)</span></code> times. Any iterable object is a valid <code class="docutils literal"><span class="pre">inputs</span></code>
attribute.</p>
<p>If you would like to have inputs be determined from a user specified input
file, then you must set the <code class="docutils literal"><span class="pre">inputFile</span></code> attribute. This is an array that
specifies what command line option may be used to control this value.</p>
<p>By default the <code class="docutils literal"><span class="pre">inputProcessor</span></code> is set to read the file line by line and
strip newline characters. To change this behavior you must set the
<code class="docutils literal"><span class="pre">inputProcessor</span></code> attribute to a function that takes as argument a file
descriptor and yield the next item. The default <code class="docutils literal"><span class="pre">inputProcessor</span></code> looks like
this:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">lineByLine</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="n">fp</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">fp</span><span class="o">.</span><span class="n">xreadlines</span><span class="p">():</span>
        <span class="k">yield</span> <span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="n">fp</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>For example, if you wanted to modify inputProcessor to read entries from a CSV file, you could use:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">inputProcessor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">csvFile</span><span class="p">:</span>
        <span class="n">reader</span> <span class="o">=</span> <span class="n">DictReader</span><span class="p">(</span><span class="n">csvFile</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">reader</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">entry</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">inputs</span></code> iterator is unique per <code class="docutils literal"><span class="pre">NetTestCase</span></code> and shared by all its measurement tests. This provides opportunities for each measurement test in a <code class="docutils literal"><span class="pre">NetTestCase</span></code> to communicate with the iterator to do things such as adding additional values to be passed to measurement tests as a later <code class="docutils literal"><span class="pre">input</span></code>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Deleting/removing the current item from the <code class="docutils literal"><span class="pre">inputs</span></code> iterator will not stop other measurement tests from operating on that <code class="docutils literal"><span class="pre">input</span></code>. When a <code class="docutils literal"><span class="pre">NetTestCase</span></code> is run a single <code class="docutils literal"><span class="pre">input</span></code> is taken from the <code class="docutils literal"><span class="pre">inputs</span></code> iterator by the OONI test loader and run against all of the individual measurement tests within that <code class="docutils literal"><span class="pre">NetTestCase</span></code>. Removing an <code class="docutils literal"><span class="pre">input</span></code> from the <code class="docutils literal"><span class="pre">inputs</span></code> iterator during a measurement will not stop that input from being called on all other measurement tests within the NetTestCase.</p>
</div>
<p>Here is one example of how you can take advantage of shared <code class="docutils literal"><span class="pre">inputs</span></code> iterator when writing your own OONI tests. If you have a list of urls and you want to make sure that you always test the HTTP equivalent of any HTTPS urls provided you can <code class="docutils literal"><span class="pre">send</span></code> values back to a custom generator in your <code class="docutils literal"><span class="pre">postProcessor</span></code>.</p>
<p>To do this the first thing you would need to create is a URL generator that can accept values sent to it.</p>
<dl class="docutils">
<dt>::</dt>
<dd><dl class="first last docutils">
<dt>class UrlGeneratorWithSend(object):</dt>
<dd><dl class="first docutils">
<dt>def __init__(self):</dt>
<dd><p class="first">&#8220;&#8221;&#8220;Create initial list and set generator state.&#8221;&#8220;&#8221;
self.urls = [&#8220;<a class="reference external" href="http://www.torproject.org">http://www.torproject.org</a>&#8221;,</p>
<blockquote>
<div>&#8220;<a class="reference external" href="https://ooni.torproject.org">https://ooni.torproject.org</a>&#8220;]</div></blockquote>
<p class="last">self.current = 0</p>
</dd>
<dt>def __iter__(self):</dt>
<dd>return self</dd>
<dt>def __next__(self):</dt>
<dd><dl class="first last docutils">
<dt>try:</dt>
<dd>cur = self.urls[self.current]
self.current += 1
return cur</dd>
<dt>except IndexError:</dt>
<dd>raise StopIteration</dd>
</dl>
</dd>
</dl>
<p># Python 2 &amp; 3 generator compatibility
next = __next__</p>
<dl class="last docutils">
<dt>def send(self, returned):</dt>
<dd><p class="first">&#8220;&#8221;&#8220;Appends a value to self.urls when activated&#8221;&#8220;&#8221;
if returned is not None:</p>
<blockquote class="last">
<div>print(&#8220;Value {0} sent to generator&#8221;.format(returned))
self.urls.append(returned)</div></blockquote>
</dd>
</dl>
</dd>
</dl>
</dd>
</dl>
<p>With this generator created you can now assign it as the <code class="docutils literal"><span class="pre">inputs</span></code> to a <code class="docutils literal"><span class="pre">NetTestCase</span></code> and <code class="docutils literal"><span class="pre">send</span></code> values back to it.</p>
<dl class="docutils">
<dt>::</dt>
<dd><p class="first">class TestUrlList(nettest.NetTestCase):</p>
<blockquote class="last">
<div><p># Adding custom generator here
inputs = UrlGeneratorWithSend()</p>
<dl class="docutils">
<dt>def postProcessor(self, measurements):</dt>
<dd><p class="first">&#8220;&#8221;&#8220;If any HTTPS url&#8217;s are passed send back an HTTP url.&#8221;&#8220;&#8221;
if re.match(&#8220;^https&#8221;, self.input):</p>
<blockquote>
<div>http_version = re.sub(&#8220;https&#8221;, &#8220;http&#8221;, self.input, 1)
self.inputs.send(http_version)</div></blockquote>
<p class="last">return self.report</p>
</dd>
<dt>def test_url(self):</dt>
<dd>self.report[&#8216;tested&#8217;] = [self.input]
return defer.succeed(1)</dd>
</dl>
</div></blockquote>
</dd>
</dl>
</div>
<div class="section" id="setup-and-command-line-passing">
<h2>Setup and command line passing<a class="headerlink" href="#setup-and-command-line-passing" title="Permalink to this headline">¶</a></h2>
<p>Tests may define the <cite>setUp</cite> method that will be called every time the
Test Case object is instantiated, in here you may place some common logic
to all your Test Methods that should be run before any testing occurs.</p>
<p>Command line arguments can be parsed thanks to the twisted
<code class="xref py py-class docutils literal"><span class="pre">twisted.python.usage.UsageOptions</span></code> class.</p>
<p>You will have to subclass this and define the NetTestCase attribute
usageOptions to point to a subclass of this.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">UsageOptions</span><span class="p">(</span><span class="n">usage</span><span class="o">.</span><span class="n">Options</span><span class="p">):</span>
  <span class="n">optParameters</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;backend&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;http://127.0.0.1:57001&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;URL of the test backend to use&#39;</span><span class="p">]</span>
                  <span class="p">]</span>

<span class="k">class</span> <span class="nc">MyTestCase</span><span class="p">(</span><span class="n">nettest</span><span class="o">.</span><span class="n">NetTestCase</span><span class="p">):</span>
  <span class="n">usageOptions</span> <span class="o">=</span> <span class="n">UsageOptions</span>

  <span class="n">inputFile</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;Some foo file&quot;</span><span class="p">]</span>
  <span class="n">requiredOptions</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;backend&#39;</span><span class="p">]</span>

  <span class="k">def</span> <span class="nf">test_my_test</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">localOptions</span><span class="p">[</span><span class="s1">&#39;backend&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>You will then be able to access the parsed command line arguments via the
class attribute localOptions.</p>
<p>The <cite>requiredOptions</cite> attributes specifies an array of parameters that are
required for the test to run properly.</p>
<p><cite>inputFile</cite> is a special class attribute that will be used for processing
of the inputFile. The filename that is read here will be given to the
<code class="xref py py-class docutils literal"><span class="pre">ooni.nettest.NetTestCase.inputProcessor</span></code> method that will yield, by
default, one line of the file at a time.</p>
</div>
<div class="section" id="test-methods">
<h2>Test Methods<a class="headerlink" href="#test-methods" title="Permalink to this headline">¶</a></h2>
<p>These shall be defined inside of your <code class="xref py py-class docutils literal"><span class="pre">ooni.nettest.NetTestCase</span></code>
subclass.  These will be class methods.</p>
<p>All class methods that are prefixed with test_ shall be run. Functions
that are relevant to your test should be all lowercase separated by
underscore.</p>
<p>To add data to the test report you may write directly to the report object
like so:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_my_function</span><span class="p">():</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">do_something</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="p">[</span><span class="s1">&#39;something&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span>
</pre></div>
</div>
<p>OONI will then handle the writing of the data to the final test report.</p>
<p>To access the current input you can use the <code class="docutils literal"><span class="pre">input</span></code> attribute, for example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_with_input</span><span class="p">():</span>
    <span class="n">do_something_with_input</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">)</span>
</pre></div>
</div>
<p>This will at each iteration over the list of inputs do something with the
input.</p>
</div>
<div class="section" id="test-templates">
<h2>Test Templates<a class="headerlink" href="#test-templates" title="Permalink to this headline">¶</a></h2>
<p>Test templates assist you in writing tests. They already contain all the
common functionality that is useful to running a test of that type. They
also take care of writing the data they collect that is relevant to the
test run to the report file.</p>
<p>Currently implemented test templates are <code class="xref py py-mod docutils literal"><span class="pre">ooni.templates.scapyt</span></code> for
tests based on Scapy, <code class="xref py py-mod docutils literal"><span class="pre">ooni.templates.tcpt</span></code> for tests based on TCP,
<code class="xref py py-mod docutils literal"><span class="pre">ooni.templates.httpt</span></code> for tests based on HTTP, and
<code class="xref py py-mod docutils literal"><span class="pre">ooni.templates.dnst</span></code> for tests based on DNS.</p>
<div class="section" id="scapy-based-tests">
<h3>Scapy based tests<a class="headerlink" href="#scapy-based-tests" title="Permalink to this headline">¶</a></h3>
<p>Scapy based tests will be a subclass of <code class="xref py py-class docutils literal"><span class="pre">ooni.templates.scapyt.BaseScapyTest</span></code>.</p>
<p>It provides a wrapper around the scapy send and receive function that will
write the sent and received packets to the report with sanitization of the
src and destination IP addresses.</p>
<p>It has the same syntax as the Scapy sr function, except that it will
return a deferred.</p>
<p>To implement a simple ICMP ping based on this function you can do like so
(Taken from <code class="xref py py-class docutils literal"><span class="pre">nettest.examples.example_scapyt.ExampleICMPPingScapy</span></code>)</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">twisted.python</span> <span class="k">import</span> <span class="n">usage</span>

<span class="kn">from</span> <span class="nn">scapy.all</span> <span class="k">import</span> <span class="n">IP</span><span class="p">,</span> <span class="n">ICMP</span>

<span class="kn">from</span> <span class="nn">ooni.templates</span> <span class="k">import</span> <span class="n">scapyt</span>

<span class="k">class</span> <span class="nc">UsageOptions</span><span class="p">(</span><span class="n">usage</span><span class="o">.</span><span class="n">Options</span><span class="p">):</span>
    <span class="n">optParameters</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;target&#39;</span><span class="p">,</span> <span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span> <span class="s2">&quot;Specify the target to ping&quot;</span><span class="p">]]</span>

<span class="k">class</span> <span class="nc">ExampleICMPPingScapy</span><span class="p">(</span><span class="n">scapyt</span><span class="o">.</span><span class="n">BaseScapyTest</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Example ICMP Ping Test&quot;</span>

    <span class="n">usageOptions</span> <span class="o">=</span> <span class="n">UsageOptions</span>

    <span class="k">def</span> <span class="nf">test_icmp_ping</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">finished</span><span class="p">(</span><span class="n">packets</span><span class="p">):</span>
            <span class="nb">print</span> <span class="n">packets</span>
            <span class="n">answered</span><span class="p">,</span> <span class="n">unanswered</span> <span class="o">=</span> <span class="n">packets</span>
            <span class="k">for</span> <span class="n">snd</span><span class="p">,</span> <span class="n">rcv</span> <span class="ow">in</span> <span class="n">answered</span><span class="p">:</span>
                <span class="n">rcv</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="n">packets</span> <span class="o">=</span> <span class="n">IP</span><span class="p">(</span><span class="n">dst</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">localOptions</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">])</span><span class="o">/</span><span class="n">ICMP</span><span class="p">()</span>
        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sr</span><span class="p">(</span><span class="n">packets</span><span class="p">)</span>
        <span class="n">d</span><span class="o">.</span><span class="n">addCallback</span><span class="p">(</span><span class="n">finished</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">d</span>
</pre></div>
</div>
<p>The arguments taken by self.sr() are exactly the same as the scapy send and
receive function, the only difference is that instead of using the regular
scapy super socket it uses our twisted driven wrapper around it.</p>
<p>Alternatively this test can also be written using the
<code class="xref py py-func docutils literal"><span class="pre">twisted.defer.inlineCallbacks()</span></code> decorator, that makes it look more similar to
regular sequential code.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">twisted.python</span> <span class="k">import</span> <span class="n">usage</span>
<span class="kn">from</span> <span class="nn">twisted.internet</span> <span class="k">import</span> <span class="n">defer</span>

<span class="kn">from</span> <span class="nn">scapy.all</span> <span class="k">import</span> <span class="n">IP</span><span class="p">,</span> <span class="n">ICMP</span>

<span class="kn">from</span> <span class="nn">ooni.templates</span> <span class="k">import</span> <span class="n">scapyt</span>

<span class="k">class</span> <span class="nc">UsageOptions</span><span class="p">(</span><span class="n">usage</span><span class="o">.</span><span class="n">Options</span><span class="p">):</span>
    <span class="n">optParameters</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;target&#39;</span><span class="p">,</span> <span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span> <span class="s2">&quot;Specify the target to ping&quot;</span><span class="p">]]</span>

<span class="k">class</span> <span class="nc">ExampleICMPPingScapyYield</span><span class="p">(</span><span class="n">scapyt</span><span class="o">.</span><span class="n">BaseScapyTest</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Example ICMP Ping Test&quot;</span>

    <span class="n">usageOptions</span> <span class="o">=</span> <span class="n">UsageOptions</span>

    <span class="nd">@defer</span><span class="o">.</span><span class="n">inlineCallbacks</span>
    <span class="k">def</span> <span class="nf">test_icmp_ping</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">packets</span> <span class="o">=</span> <span class="n">IP</span><span class="p">(</span><span class="n">dst</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">localOptions</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">])</span><span class="o">/</span><span class="n">ICMP</span><span class="p">()</span>
        <span class="n">answered</span><span class="p">,</span> <span class="n">unanswered</span> <span class="o">=</span> <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">sr</span><span class="p">(</span><span class="n">packets</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">snd</span><span class="p">,</span> <span class="n">rcv</span> <span class="ow">in</span> <span class="n">answered</span><span class="p">:</span>
            <span class="n">rcv</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<div class="section" id="report-format">
<h4>Report Format<a class="headerlink" href="#report-format" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default"><div class="highlight"><pre><span></span>###########################################
# OONI Probe Report for Example ICMP Ping Test test
# Thu Nov 22 18:20:43 2012
###########################################
---
{probe_asn: null, probe_cc: null, probe_ip: 127.0.0.1, software_name: ooniprobe, software_version: 0.0.7.1-alpha,
  start_time: 1353601243.0, test_name: Example ICMP Ping Test, test_version: 0.1}
...
---
input: null
report:
  answer_flags: [ipsrc]
  answered_packets:
  - - raw_packet: !!binary |
        RQAAHAEdAAAuAbjKCAgICH8AAAEAAAAAAAAAAA==
      summary: IP / ICMP 8.8.8.8 &gt; 127.0.0.1 echo-reply 0
  sent_packets:
  - - raw_packet: !!binary |
        RQAAHAABAABAAevPfwAAAQgICAgIAPf/AAAAAA==
      summary: IP / ICMP 127.0.0.1 &gt; 8.8.8.8 echo-request 0
test_name: test_icmp_ping
test_started: 1353604843.553605
...
</pre></div>
</div>
</div>
</div>
<div class="section" id="tcp-based-tests">
<h3>TCP based tests<a class="headerlink" href="#tcp-based-tests" title="Permalink to this headline">¶</a></h3>
<p>TCP based tests will subclass <code class="xref py py-class docutils literal"><span class="pre">ooni.templates.tcpt.TCPTest</span></code>.</p>
<p>This test template facilitates the sending of TCP payloads to the wire and
recording the response.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">twisted.internet.error</span> <span class="k">import</span> <span class="ne">ConnectionRefusedError</span>
<span class="kn">from</span> <span class="nn">ooni.utils</span> <span class="k">import</span> <span class="n">log</span>
<span class="kn">from</span> <span class="nn">ooni.templates</span> <span class="k">import</span> <span class="n">tcpt</span>

<span class="k">class</span> <span class="nc">ExampleTCPT</span><span class="p">(</span><span class="n">tcpt</span><span class="o">.</span><span class="n">TCPTest</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">test_hello_world</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">got_response</span><span class="p">(</span><span class="n">response</span><span class="p">):</span>
            <span class="nb">print</span> <span class="s2">&quot;Got this data </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">response</span>

        <span class="k">def</span> <span class="nf">connection_failed</span><span class="p">(</span><span class="n">failure</span><span class="p">):</span>
            <span class="n">failure</span><span class="o">.</span><span class="n">trap</span><span class="p">(</span><span class="ne">ConnectionRefusedError</span><span class="p">)</span>
            <span class="nb">print</span> <span class="s2">&quot;Connection Refused&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">address</span> <span class="o">=</span> <span class="s2">&quot;127.0.0.1&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">port</span> <span class="o">=</span> <span class="mi">57002</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="s2">&quot;Hello World!</span><span class="se">\n\r</span><span class="s2">&quot;</span>
        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sendPayload</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
        <span class="n">d</span><span class="o">.</span><span class="n">addErrback</span><span class="p">(</span><span class="n">connection_failed</span><span class="p">)</span>
        <span class="n">d</span><span class="o">.</span><span class="n">addCallback</span><span class="p">(</span><span class="n">got_response</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">d</span>
</pre></div>
</div>
<p>The possible failures for a TCP connection are:</p>
<p><code class="xref py py-class docutils literal"><span class="pre">twisted.internet.error.NoRouteError</span></code> that corresponds to errno.ENETUNREACH</p>
<p><code class="xref py py-class docutils literal"><span class="pre">twisted.internet.error.ConnectionRefusedError</span></code> that corresponds to
errno.ECONNREFUSED</p>
<p><code class="xref py py-class docutils literal"><span class="pre">twisted.internet.error.TCPTimedOutError</span></code> that corresponds to errno.ETIMEDOUT</p>
<div class="section" id="id1">
<h4>Report format<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h4>
<p>The basic report of a TCP test looks like the following (this is an report
generated by running the above example against a TCP echo server).</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1">###########################################</span>
<span class="c1"># OONI Probe Report for Base TCP Test test</span>
<span class="c1"># Thu Nov 22 18:18:28 2012</span>
<span class="c1">###########################################</span>
<span class="o">---</span>
<span class="p">{</span><span class="n">probe_asn</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span> <span class="n">probe_cc</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span> <span class="n">probe_ip</span><span class="p">:</span> <span class="mf">127.0</span><span class="o">.</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">software_name</span><span class="p">:</span> <span class="n">ooniprobe</span><span class="p">,</span> <span class="n">software_version</span><span class="p">:</span> <span class="mf">0.0</span><span class="o">.</span><span class="mf">7.1</span><span class="o">-</span><span class="n">alpha</span><span class="p">,</span>
  <span class="n">start_time</span><span class="p">:</span> <span class="mf">1353601108.0</span><span class="p">,</span> <span class="n">test_name</span><span class="p">:</span> <span class="n">Base</span> <span class="n">TCP</span> <span class="n">Test</span><span class="p">,</span> <span class="n">test_version</span><span class="p">:</span> <span class="s1">&#39;0.1&#39;</span><span class="p">}</span>
<span class="o">...</span>
<span class="o">---</span>
<span class="nb">input</span><span class="p">:</span> <span class="n">null</span>
<span class="n">report</span><span class="p">:</span>
  <span class="n">errors</span><span class="p">:</span> <span class="p">[]</span>
  <span class="n">received</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Hello World!</span><span class="se">\n\r</span><span class="s2">&quot;</span><span class="p">]</span>
  <span class="n">sent</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Hello World!</span><span class="se">\n\r</span><span class="s2">&quot;</span><span class="p">]</span>
<span class="n">test_name</span><span class="p">:</span> <span class="n">test_hello_world</span>
<span class="n">test_started</span><span class="p">:</span> <span class="mf">1353604708.705081</span>
<span class="o">...</span>
</pre></div>
</div>
<p>TODO finish this with more details</p>
</div>
</div>
<div class="section" id="http-based-tests">
<h3>HTTP based tests<a class="headerlink" href="#http-based-tests" title="Permalink to this headline">¶</a></h3>
<p>HTTP based tests will be a subclass of  <code class="xref py py-class docutils literal"><span class="pre">ooni.templates.httpt.HTTPTest</span></code>.</p>
<p>It provides methods <code class="xref py py-func docutils literal"><span class="pre">ooni.templates.httpt.HTTPTest.processResponseBody()</span></code> and
<code class="xref py py-func docutils literal"><span class="pre">ooni.templates.httpt.HTTPTest.processResponseHeaders()</span></code> for interacting with the
response body and headers respectively.</p>
<p>For example, to implement a HTTP test that returns the sha256 hash of the
response body (based on <code class="xref py py-mod docutils literal"><span class="pre">nettests.examples.example_httpt</span></code>):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ooni.utils</span> <span class="k">import</span> <span class="n">log</span>
<span class="kn">from</span> <span class="nn">ooni.templates</span> <span class="k">import</span> <span class="n">httpt</span>
<span class="kn">from</span> <span class="nn">hashlib</span> <span class="k">import</span> <span class="n">sha256</span>

<span class="k">class</span> <span class="nc">SHA256HTTPBodyTest</span><span class="p">(</span><span class="n">httpt</span><span class="o">.</span><span class="n">HTTPTest</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;ChecksumHTTPBodyTest&quot;</span>
    <span class="n">author</span> <span class="o">=</span> <span class="s2">&quot;Aaron Gibson&quot;</span>
    <span class="n">version</span> <span class="o">=</span> <span class="mf">0.1</span>

    <span class="n">inputFile</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;url file&#39;</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s1">&#39;List of URLS to perform GET requests to&#39;</span><span class="p">]</span>
    <span class="n">requiredOptions</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;url file&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">test_http</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">:</span>
            <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">doRequest</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;No input specified&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">processResponseBody</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">body</span><span class="p">):</span>
        <span class="n">body_sha256sum</span> <span class="o">=</span> <span class="n">sha256</span><span class="p">(</span><span class="n">body</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="p">[</span><span class="s1">&#39;checksum&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">body_sha256sum</span>
</pre></div>
</div>
<div class="section" id="id2">
<h4>Report format<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1">###########################################</span>
<span class="c1"># OONI Probe Report for ChecksumHTTPBodyTest test</span>
<span class="c1"># Thu Dec  6 17:31:57 2012</span>
<span class="c1">###########################################</span>
<span class="o">---</span>
<span class="n">options</span><span class="p">:</span>
  <span class="n">collector</span><span class="p">:</span> <span class="n">null</span>
  <span class="n">help</span><span class="p">:</span> <span class="mi">0</span>
  <span class="n">logfile</span><span class="p">:</span> <span class="n">null</span>
  <span class="n">pcapfile</span><span class="p">:</span> <span class="n">null</span>
  <span class="n">reportfile</span><span class="p">:</span> <span class="n">null</span>
  <span class="n">resume</span><span class="p">:</span> <span class="mi">0</span>
  <span class="n">subargs</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="n">f</span><span class="p">,</span> <span class="n">hosts</span><span class="p">]</span>
  <span class="n">test</span><span class="p">:</span> <span class="n">nettests</span><span class="o">/</span><span class="n">examples</span><span class="o">/</span><span class="n">example_http_checksum</span><span class="o">.</span><span class="n">py</span>
<span class="n">probe_asn</span><span class="p">:</span> <span class="n">null</span>
<span class="n">probe_cc</span><span class="p">:</span> <span class="n">null</span>
<span class="n">probe_ip</span><span class="p">:</span> <span class="mf">127.0</span><span class="o">.</span><span class="mf">0.1</span>
<span class="n">software_name</span><span class="p">:</span> <span class="n">ooniprobe</span>
<span class="n">software_version</span><span class="p">:</span> <span class="mf">0.0</span><span class="o">.</span><span class="mf">7.1</span><span class="o">-</span><span class="n">alpha</span>
<span class="n">start_time</span><span class="p">:</span> <span class="mf">1354786317.0</span>
<span class="n">test_name</span><span class="p">:</span> <span class="n">ChecksumHTTPBodyTest</span>
<span class="n">test_version</span><span class="p">:</span> <span class="mf">0.1</span>
<span class="o">...</span>
<span class="o">---</span>
<span class="nb">input</span><span class="p">:</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">google</span><span class="o">.</span><span class="n">com</span>
<span class="n">report</span><span class="p">:</span>
  <span class="n">agent</span><span class="p">:</span> <span class="n">agent</span>
  <span class="n">checksum</span><span class="p">:</span> <span class="n">d630fa2efd547d3656e349e96ff7af5496889dad959e8e29212af1ff843e7aa1</span>
  <span class="n">requests</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">request</span><span class="p">:</span>
      <span class="n">body</span><span class="p">:</span> <span class="n">null</span>
      <span class="n">headers</span><span class="p">:</span>
      <span class="o">-</span> <span class="o">-</span> <span class="n">User</span><span class="o">-</span><span class="n">Agent</span>
        <span class="o">-</span> <span class="o">-</span> <span class="p">[</span><span class="n">Opera</span><span class="o">/</span><span class="mf">9.00</span> <span class="p">(</span><span class="n">Windows</span> <span class="n">NT</span> <span class="mf">5.1</span><span class="p">;</span> <span class="n">U</span><span class="p">;</span> <span class="n">en</span><span class="p">),</span> <span class="s1">&#39;Opera 9.0, Windows XP&#39;</span><span class="p">]</span>
      <span class="n">method</span><span class="p">:</span> <span class="n">GET</span>
      <span class="n">url</span><span class="p">:</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">google</span><span class="o">.</span><span class="n">com</span>
    <span class="n">response</span><span class="p">:</span>
      <span class="n">body</span><span class="p">:</span> <span class="s1">&#39;&lt;!doctype html&gt;&lt;html ... snip ...  &lt;/html&gt;&#39;</span>
      <span class="n">code</span><span class="p">:</span> <span class="mi">200</span>
      <span class="n">headers</span><span class="p">:</span>
      <span class="o">-</span> <span class="o">-</span> <span class="n">X</span><span class="o">-</span><span class="n">XSS</span><span class="o">-</span><span class="n">Protection</span>
        <span class="o">-</span> <span class="p">[</span><span class="mi">1</span><span class="p">;</span> <span class="n">mode</span><span class="o">=</span><span class="n">block</span><span class="p">]</span>
      <span class="o">-</span> <span class="o">-</span> <span class="n">Set</span><span class="o">-</span><span class="n">Cookie</span>
        <span class="o">-</span> <span class="p">[</span><span class="s1">&#39;PREF=ID=fada4216eb3684f9:FF=0:TM=1354800717:LM=1354800717:S=IT-2GCkNAocyXlVa;</span>
            <span class="n">expires</span><span class="o">=</span><span class="n">Sat</span><span class="p">,</span> <span class="mi">06</span><span class="o">-</span><span class="n">Dec</span><span class="o">-</span><span class="mi">2014</span> <span class="mi">13</span><span class="p">:</span><span class="mi">31</span><span class="p">:</span><span class="mi">57</span> <span class="n">GMT</span><span class="p">;</span> <span class="n">path</span><span class="o">=/</span><span class="p">;</span> <span class="n">domain</span><span class="o">=.</span><span class="n">google</span><span class="o">.</span><span class="n">com</span><span class="s1">&#39;, &#39;</span><span class="n">NID</span><span class="o">=</span><span class="mi">66</span><span class="o">=</span><span class="n">KWaLbNQumuGuYf0HrWlGm54u9l</span><span class="o">-</span><span class="n">DKJwhFCMQXfhQPZM</span><span class="o">-</span><span class="n">qniRhmF6QRGXUKXb_8CIUuCOHnyoC5oAX5jWNrsfk</span><span class="o">-</span><span class="n">LLJLW530UiMp6hemTtDMh_e6GSiEB4GR3yOP_E0TCN</span><span class="p">;</span>
            <span class="n">expires</span><span class="o">=</span><span class="n">Fri</span><span class="p">,</span> <span class="mi">07</span><span class="o">-</span><span class="n">Jun</span><span class="o">-</span><span class="mi">2013</span> <span class="mi">13</span><span class="p">:</span><span class="mi">31</span><span class="p">:</span><span class="mi">57</span> <span class="n">GMT</span><span class="p">;</span> <span class="n">path</span><span class="o">=/</span><span class="p">;</span> <span class="n">domain</span><span class="o">=.</span><span class="n">google</span><span class="o">.</span><span class="n">com</span><span class="p">;</span> <span class="n">HttpOnly</span><span class="s1">&#39;]</span>
      <span class="o">-</span> <span class="o">-</span> <span class="n">Expires</span>
        <span class="o">-</span> <span class="p">[</span><span class="s1">&#39;-1&#39;</span><span class="p">]</span>
      <span class="o">-</span> <span class="o">-</span> <span class="n">Server</span>
        <span class="o">-</span> <span class="p">[</span><span class="n">gws</span><span class="p">]</span>
      <span class="o">-</span> <span class="o">-</span> <span class="n">Connection</span>
        <span class="o">-</span> <span class="p">[</span><span class="n">close</span><span class="p">]</span>
      <span class="o">-</span> <span class="o">-</span> <span class="n">Cache</span><span class="o">-</span><span class="n">Control</span>
        <span class="o">-</span> <span class="p">[</span><span class="s1">&#39;private, max-age=0&#39;</span><span class="p">]</span>
      <span class="o">-</span> <span class="o">-</span> <span class="n">Date</span>
        <span class="o">-</span> <span class="p">[</span><span class="s1">&#39;Thu, 06 Dec 2012 13:31:57 GMT&#39;</span><span class="p">]</span>
      <span class="o">-</span> <span class="o">-</span> <span class="n">P3P</span>
        <span class="o">-</span> <span class="p">[</span><span class="s1">&#39;CP=&quot;This is not a P3P policy! See http://www.google.com/support/accounts/bin/answer.py?hl=en&amp;answer=151657</span>
            <span class="k">for</span> <span class="n">more</span> <span class="n">info</span><span class="o">.</span><span class="s2">&quot;&#39;]</span>
      <span class="o">-</span> <span class="o">-</span> <span class="n">Content</span><span class="o">-</span><span class="n">Type</span>
        <span class="o">-</span> <span class="p">[</span><span class="n">text</span><span class="o">/</span><span class="n">html</span><span class="p">;</span> <span class="n">charset</span><span class="o">=</span><span class="n">UTF</span><span class="o">-</span><span class="mi">8</span><span class="p">]</span>
      <span class="o">-</span> <span class="o">-</span> <span class="n">X</span><span class="o">-</span><span class="n">Frame</span><span class="o">-</span><span class="n">Options</span>
        <span class="o">-</span> <span class="p">[</span><span class="n">SAMEORIGIN</span><span class="p">]</span>
  <span class="n">socksproxy</span><span class="p">:</span> <span class="n">null</span>
<span class="n">test_name</span><span class="p">:</span> <span class="n">test_http</span>
<span class="n">test_runtime</span><span class="p">:</span> <span class="mf">0.08298492431640625</span>
<span class="n">test_started</span><span class="p">:</span> <span class="mf">1354800717.478403</span>
<span class="o">...</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="dns-based-tests">
<h3>DNS based tests<a class="headerlink" href="#dns-based-tests" title="Permalink to this headline">¶</a></h3>
<p>DNS based tests will be a subclass of <code class="xref py py-class docutils literal"><span class="pre">ooni.templates.dnst.DNSTest</span></code>.</p>
<p>It provides methods <code class="xref py py-func docutils literal"><span class="pre">ooni.templates.dnst.DNSTest.performPTRLookup()</span></code>
and <code class="xref py py-func docutils literal"><span class="pre">ooni.templates.dnst.DNSTest.performALookup()</span></code></p>
<p>For example (taken from <code class="xref py py-mod docutils literal"><span class="pre">nettests.examples.example_dnst</span></code>):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ooni.templates.dnst</span> <span class="k">import</span> <span class="n">DNSTest</span>

<span class="k">class</span> <span class="nc">ExampleDNSTest</span><span class="p">(</span><span class="n">DNSTest</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">test_a_lookup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">gotResult</span><span class="p">(</span><span class="n">result</span><span class="p">):</span>
            <span class="c1"># Result is an array containing all the A record lookup results</span>
            <span class="nb">print</span> <span class="n">result</span>

        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">performALookup</span><span class="p">(</span><span class="s1">&#39;torproject.org&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;8.8.8.8&#39;</span><span class="p">,</span> <span class="mi">53</span><span class="p">))</span>
        <span class="n">d</span><span class="o">.</span><span class="n">addCallback</span><span class="p">(</span><span class="n">gotResult</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">d</span>
</pre></div>
</div>
<div class="section" id="id3">
<h4>Report format<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1">###########################################</span>
<span class="c1"># OONI Probe Report for Base DNS Test test</span>
<span class="c1"># Thu Dec  6 17:42:51 2012</span>
<span class="c1">###########################################</span>
<span class="o">---</span>
<span class="n">options</span><span class="p">:</span>
  <span class="n">collector</span><span class="p">:</span> <span class="n">null</span>
  <span class="n">help</span><span class="p">:</span> <span class="mi">0</span>
  <span class="n">logfile</span><span class="p">:</span> <span class="n">null</span>
  <span class="n">pcapfile</span><span class="p">:</span> <span class="n">null</span>
  <span class="n">reportfile</span><span class="p">:</span> <span class="n">null</span>
  <span class="n">resume</span><span class="p">:</span> <span class="mi">0</span>
  <span class="n">subargs</span><span class="p">:</span> <span class="p">[]</span>
  <span class="n">test</span><span class="p">:</span> <span class="n">nettests</span><span class="o">/</span><span class="n">examples</span><span class="o">/</span><span class="n">example_dnst</span><span class="o">.</span><span class="n">py</span>
<span class="n">probe_asn</span><span class="p">:</span> <span class="n">null</span>
<span class="n">probe_cc</span><span class="p">:</span> <span class="n">null</span>
<span class="n">probe_ip</span><span class="p">:</span> <span class="mf">127.0</span><span class="o">.</span><span class="mf">0.1</span>
<span class="n">software_name</span><span class="p">:</span> <span class="n">ooniprobe</span>
<span class="n">software_version</span><span class="p">:</span> <span class="mf">0.0</span><span class="o">.</span><span class="mf">7.1</span><span class="o">-</span><span class="n">alpha</span>
<span class="n">start_time</span><span class="p">:</span> <span class="mf">1354786971.0</span>
<span class="n">test_name</span><span class="p">:</span> <span class="n">Base</span> <span class="n">DNS</span> <span class="n">Test</span>
<span class="n">test_version</span><span class="p">:</span> <span class="mf">0.1</span>
<span class="o">...</span>
<span class="o">---</span>
<span class="nb">input</span><span class="p">:</span> <span class="n">null</span>
<span class="n">report</span><span class="p">:</span>
  <span class="n">queries</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">addrs</span><span class="p">:</span> <span class="p">[</span><span class="mf">82.195</span><span class="o">.</span><span class="mf">75.101</span><span class="p">,</span> <span class="mf">86.59</span><span class="o">.</span><span class="mf">30.40</span><span class="p">,</span> <span class="mf">38.229</span><span class="o">.</span><span class="mf">72.14</span><span class="p">,</span> <span class="mf">38.229</span><span class="o">.</span><span class="mf">72.16</span><span class="p">]</span>
    <span class="n">answers</span><span class="p">:</span>
    <span class="o">-</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">RR</span> <span class="n">name</span><span class="o">=</span><span class="n">torproject</span><span class="o">.</span><span class="n">org</span> <span class="nb">type</span><span class="o">=</span><span class="n">A</span> <span class="n">class</span><span class="o">=</span><span class="n">IN</span> <span class="n">ttl</span><span class="o">=</span><span class="mi">782</span><span class="n">s</span> <span class="n">auth</span><span class="o">=</span><span class="kc">False</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">A</span> <span class="n">address</span><span class="o">=</span><span class="mf">82.195</span><span class="o">.</span><span class="mf">75.101</span>
        <span class="n">ttl</span><span class="o">=</span><span class="mi">782</span><span class="o">&gt;</span><span class="p">]</span>
    <span class="o">-</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">RR</span> <span class="n">name</span><span class="o">=</span><span class="n">torproject</span><span class="o">.</span><span class="n">org</span> <span class="nb">type</span><span class="o">=</span><span class="n">A</span> <span class="n">class</span><span class="o">=</span><span class="n">IN</span> <span class="n">ttl</span><span class="o">=</span><span class="mi">782</span><span class="n">s</span> <span class="n">auth</span><span class="o">=</span><span class="kc">False</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">A</span> <span class="n">address</span><span class="o">=</span><span class="mf">86.59</span><span class="o">.</span><span class="mf">30.40</span>
        <span class="n">ttl</span><span class="o">=</span><span class="mi">782</span><span class="o">&gt;</span><span class="p">]</span>
    <span class="o">-</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">RR</span> <span class="n">name</span><span class="o">=</span><span class="n">torproject</span><span class="o">.</span><span class="n">org</span> <span class="nb">type</span><span class="o">=</span><span class="n">A</span> <span class="n">class</span><span class="o">=</span><span class="n">IN</span> <span class="n">ttl</span><span class="o">=</span><span class="mi">782</span><span class="n">s</span> <span class="n">auth</span><span class="o">=</span><span class="kc">False</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">A</span> <span class="n">address</span><span class="o">=</span><span class="mf">38.229</span><span class="o">.</span><span class="mf">72.14</span>
        <span class="n">ttl</span><span class="o">=</span><span class="mi">782</span><span class="o">&gt;</span><span class="p">]</span>
    <span class="o">-</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">RR</span> <span class="n">name</span><span class="o">=</span><span class="n">torproject</span><span class="o">.</span><span class="n">org</span> <span class="nb">type</span><span class="o">=</span><span class="n">A</span> <span class="n">class</span><span class="o">=</span><span class="n">IN</span> <span class="n">ttl</span><span class="o">=</span><span class="mi">782</span><span class="n">s</span> <span class="n">auth</span><span class="o">=</span><span class="kc">False</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">A</span> <span class="n">address</span><span class="o">=</span><span class="mf">38.229</span><span class="o">.</span><span class="mf">72.16</span>
        <span class="n">ttl</span><span class="o">=</span><span class="mi">782</span><span class="o">&gt;</span><span class="p">]</span>
    <span class="n">query</span><span class="p">:</span> <span class="s1">&#39;[Query(&#39;&#39;torproject.org&#39;&#39;, 1, 1)]&#39;</span>
    <span class="n">query_type</span><span class="p">:</span> <span class="n">A</span>
    <span class="n">resolver</span><span class="p">:</span> <span class="p">[</span><span class="mf">8.8</span><span class="o">.</span><span class="mf">8.8</span><span class="p">,</span> <span class="mi">53</span><span class="p">]</span>
<span class="n">test_name</span><span class="p">:</span> <span class="n">test_a_lookup</span>
<span class="n">test_runtime</span><span class="p">:</span> <span class="mf">0.028924942016601562</span>
<span class="n">test_started</span><span class="p">:</span> <span class="mf">1354801371.980114</span>
<span class="o">...</span>
</pre></div>
</div>
<p>For a more complex example, see: <code class="xref py py-mod docutils literal"><span class="pre">nettests.blocking.dnsconsistency</span></code></p>
</div>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="writing_test_helpers.html" class="btn btn-neutral float-right" title="Writing Test Helpers" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="tutorial.html" class="btn btn-neutral" title="Tutorial" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, The Tor Project.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'2.0.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>